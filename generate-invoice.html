<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Generate Invoice - Shrish Admin</title>

    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/svg+xml" href="/assets/images/favicon/favicon.svg">
    <link rel="icon" type="image/x-icon" href="/assets/images/favicon/favicon.ico">
    <link rel="manifest" href="/assets/images/favicon/site.webmanifest">
    <meta property="og:title" content="Generate Invoice - Shrish Admin" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="Admin panel for generating new customer invoices for Shrish Travels." />
    <meta property="og:image" content="https://admin.shrishgroup.com/assets/images/logo.webp" /> 
    <meta name="twitter:card" content="summary" />
    <link rel="stylesheet" href="/assets/css/admin.css">
    <link rel="stylesheet" href="/assets/css/common.css">
    <link rel="stylesheet" href="/assets/css/invoice.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>

<body>
    <div id="admin-sidebar"></div>

    <div class="admin-main-content">
    
        <div id="admin-header"></div>

        <main class="page-content">
            <div class="page-header">
                <h1>Invoice Generator</h1>
                <p>Create a new client invoice from a completed duty slip.</p>
            </div>

            <div class="card">
                <div class="stepper-container">
                    <div class="step active" data-step="1">
                        <div class="step-icon"><i class="fas fa-search"></i></div>
                        <div class="step-label">Load Trip</div>
                    </div>
                    <div class="step-divider"></div>
                    <div class="step" data-step="2">
                        <div class="step-icon"><i class="fas fa-calculator"></i></div>
                        <div class="step-label">Verify</div>
                    </div>
                    <div class="step-divider"></div>
                    <div class="step" data-step="3">
                        <div class="step-icon"><i class="fas fa-tasks"></i></div>
                        <div class="step-label">Set Rates</div>
                    </div>
                    <div class="step-divider"></div>
                    <div class="step" data-step="4">
                        <div class="step-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="step-label">Generate</div>
                    </div>
                </div>

                <div class="step-content-container">

                    <div class="step-content active" data-step-content="1">
                        <h2>Step 1: Get Booking ID</h2>
                        <p>To load an existing trip, enter its ID and click "Load". To create a new invoice, just click "Enter Details Manually".</p>
                        <div class="form-group">
                            <label for="bookingIdInput">Booking ID (DS_No):</label>
                            <input type="text" id="bookingIdInput" placeholder="Enter ID (e.g., 5) to load a trip">
                        </div>
                        <div class="step1-actions">
                            <button id="loadTripButton" class="btn btn-primary">
                                <i class="fas fa-search"></i> Load Existing Trip
                            </button>
                            <span class="or-divider">OR</span>
                            <button id="manualEntryButton" class="btn btn-secondary">
                                <i class="fas fa-pencil-alt"></i> Enter Details Manually
                            </button>
                        </div>
                        <div id="loader" class="loader" style="display: none;"></div>
                    </div>

                    <div class="step-content" data-step-content="2">
                        <h2>Step 2: Verify & Edit Details</h2>

                        <div id="tripSummary" class="trip-summary-box" style="display: none;">
                        </div>

                        <div id="manualEntryFields" style="display: none;">
                            <h4 class="section-divider">Manual Trip Details</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="manualGuestName">Guest Name</label>
                                    <input type="text" id="manualGuestName" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="manualGuestMobile">Guest Mobile</label>
                                    <input type="text" id="manualGuestMobile" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="manualVehicleType">Vehicle Type</label>
                                    <input type="text" id="manualVehicleType" class="form-control"
                                        placeholder="e.g., Etios">
                                </div>
                                <div class="form-group">
                                    <label for="manualVehicleNo">Vehicle No</label>
                                    <input type="text" id="manualVehicleNo" class="form-control"
                                        placeholder="e.g., TN01AB1234" 
                                        style="text-transform: uppercase;" 
                                        oninput="this.value = this.value.toUpperCase()">
                                </div>
                                <div class="form-group">
                                    <label for="manualStartDate">Trip Start Date</label>
                                    <input type="date" id="manualStartDate" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="manualEndDate">Trip End Date</G/label>
                                    <input type="date" id="manualEndDate" class="form-control">
                                </div>
                            </div>

                            <h4 class="section-divider">Notes (Optional)</h4>
                        <div class="form-grid">
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label for="invoiceNote">
                                    Reason for Manual Change
                                    <span class="calc-context">
                                        (e.g., "Corrected KMs from 400 to 380", "Client discount")
                                    </span>
                                </label>
                                <textarea id="invoiceNote" class="form-control" rows="3" 
                                    placeholder="This note will be saved for internal records."></textarea>
                            </div>
                        </div>

                        </div>

                        <h4 class="section-divider">Calculation Details</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="calcTotalHours">
                                    Total Hours (Editable)
                                    <span class="calc-context">
                                        (<span id="time-out-context">--</span> - <span id="time-in-context">--</span> =
                                        <span id="total-hrs-context">--</span>)
                                    </span>
                                </label>
                                <input type="number" id="calcTotalHours" step="0.01" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="calcTotalKms">Total KMs (Editable)</label>
                                <input type="number" id="calcTotalKms" step="0.1" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="calcBillingSlabs">Billing Slabs (Editable)</label>
                                <input type="number" id="calcBillingSlabs" step="1" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="upiId">UPI ID (for QR Code)</label>
                                <input type="text" id="upiId" value="drumsjega5466-1@okhdfcbank" class="form-control">
                            </div>
                        </div>

                        <div class="help-text">
                            <i class="fas fa-info-circle"></i>
                            <strong>What is a "Slab"?</strong> A "Slab" is one 12-hour billing period. If a trip is 20
                            hours long, it falls into 2 slabs (1-12 hrs is 1 slab, 12-24 hrs is 2 slabs).
                        </div>
                    </div>

                    <div class="step-content" data-step-content="3">
                        <h2>Step 3: Enter Billing Rates & Expenses</h2>
                        <p>These values are pre-filled, but you can adjust them as needed.</p>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="baseRate">Base Rate per Slab (₹)
                                    <span class="calc-context">
                                        (<span id="baseRateSlabs">--</span> Slabs * ₹<span id="baseRateValue">--.--</span> = ₹<span id="baseRateTotal">--.--</span>)
                                    </span>
                                </label>
                                <input type="number" id="baseRate" value="3900" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="includedKms">Included KMs per Slab
                                    <span class="calc-context">
                                        (<span id="includedKmsSlabs">--</span> Slabs * <span id="includedKmsValue">--</span> KMs = <span id="includedKmsTotal">--</span> KMs)
                                    </span>
                                </label>
                                <input type="number" id="includedKms" value="300" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="extraKmRate">Extra KM Rate (₹)
                                    <span class="calc-context">
                                       (<span id="extraKmCalcResult">--.--</span> KMs * ₹<span id="extraKmRateValue">--.--</span> = ₹<span id="extraKmCostTotal">--.--</span>)
                                    </span>
                                </label>
                                <input type="number" id="extraKmRate" value="14" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="battaRate">Driver Batta per Slab (₹)
                                    <span class="calc-context">
                                        (<span id="battaRateSlabs">--</span> Slabs * ₹<span id="battaRateValue">--.--</span> = ₹<span id="battaRateTotal">--.--</span>)
                                    </span>
                                </label>
                                <input type="number" id="battaRate" value="600" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="tolls">Tolls & Parking (₹)
                                    <span class="calc-context">(Total amount for all tolls)</span>
                                </label>
                                <input type="number" id="tolls" placeholder="e.g., 700" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="permits">State Permits (₹)
                                    <span class="calc-context">(Total amount for all permits)</span>
                                </label>
                                <input type="number" id="permits" value="0" class="form-control">
                            </div>
                        </div>

                        <div id="runningTotalDisplay" class="running-total">
                            Calculated Grand Total: <strong id="runningGrandTotal">₹ --.--</strong>
                        </div>
                    </div>

                    <div class="step-content" data-step-content="4">
                        <h2>Step 4: Review & Generate</h2>
                        <p>Please review the final invoice summary below before saving and generating the link.</p>

                        <div id="finalInvoiceSummary" class="invoice-summary-preview">
                            <div class="loader"></div>
                        </div>

                        <div id="generatedLinkContainer" class="share-hub-card" style="display: none;">
    <div class="success-icon-check">
        <i class="fas fa-check-circle"></i>
        <h3 style="font-family: 'Lora', serif; font-size: 1.8rem; margin-top: 10px;">Ready to Send!</h3>
        <p style="color: #64748b;">The system-calculated invoice is ready for the guest.</p>
    </div>
    
    <div class="share-actions-grid">
        <button id="whatsappShareBtn" class="btn share-btn-whatsapp">
            <i class="fab fa-whatsapp"></i> Share to WhatsApp
        </button>

        <button id="copyLinkBtn" class="btn share-btn-copy">
            <i class="fas fa-copy"></i> Copy Link
        </button>
    </div>

    <div class="link-preview-box">
        <label style="font-size: 0.65rem; letter-spacing: 1px; color: #94a3b8; text-transform: uppercase;">Secure Invoice Link</label>
        <input type="text" id="generatedLink" readonly>
    </div>
</div>
                        <div id="save-loader" class="loader" style="display: none;"></div>
                    </div>

                </div>
                <div class="negotiation-toggle-container" style="margin-top: 1.5rem; padding: 1rem; background: #fdf2f2; border-radius: 12px; border: 1px solid #fee2e2;">
    <label class="custom-checkbox-container" style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
        <input type="checkbox" id="useNegotiationShield" checked style="width: 20px; height: 20px; accent-color: #ef4444;">
        <div class="checkbox-text">
            <strong style="display: block; color: #991b1b; font-size: 0.9rem;">Enable Negotiation Shield?</strong>
            <span style="font-size: 0.8rem; color: #b91c1c;">Check this if the price is fixed by the system. Uncheck if you made manual adjustments.</span>
        </div>
    </label>
</div>

                <div class="step-navigation">
                    <button id="prevStepBtn" class="btn" style="display: none;">
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button id="nextStepBtn" class="btn btn-primary" style="display: none;">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                    <button id="saveInvoiceBtn" class="btn btn-success" style="display: none;">
                        <i class="fas fa-save"></i> Save & Generate
                    </button>
                </div>
            </div>
            
        </main>
<div id="admin-footer"></div>

    </div> <script src="/assets/js/common.js"></script>
    <script src="/assets/js/generate-invoice.js"></script>
</body>

</html>