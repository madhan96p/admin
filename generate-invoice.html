<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Invoice - Shrish Admin</title>
    <link rel="stylesheet" href="/assets/css/common.css">
    <link rel="stylesheet" href="/assets/css/invoice.css">
    <script src="https://kit.fontawesome.com/your-font-awesome-kit.js" crossorigin="anonymous"></script>
</head>

<body>
    <div class="page-container">
        <main class="main-content">
            <div class="page-header">
                <h1>Invoice Generator</h1>
                <p>Create a new client invoice from a completed duty slip.</p>
            </div>

            <div class="card">
                <div class="stepper-container">
                    <div class="step active" data-step="1">
                        <div class="step-icon"><i class="fas fa-search"></i></div>
                        <div class="step-label">Load Trip</div>
                    </div>
                    <div class="step-divider"></div>
                    <div class="step" data-step="2">
                        <div class="step-icon"><i class="fas fa-calculator"></i></div>
                        <div class="step-label">Verify</div>
                    </div>
                    <div class="step-divider"></div>
                    <div class="step" data-step="3">
                        <div class="step-icon"><i class="fas fa-tasks"></i></div>
                        <div class="step-label">Set Rates</div>
                    </div>
                    <div class="step-divider"></div>
                    <div class="step" data-step="4">
                        <div class="step-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="step-label">Generate</div>
                    </div>
                </div>

                <div class="step-content-container">

                    <div class="step-content active" data-step-content="1">
                        <h2>Step 1: Get Booking ID</h2>
                        <p>Enter a new or existing Booking ID (DS_No), then choose how to proceed.</p>
                        <div class="form-group">
                            <label for="bookingIdInput">Booking ID (DS_No):</label>
                            <input type="text" id="bookingIdInput" placeholder="e.g., 5 or MANUAL-101">
                        </div>
                        <div class="step1-actions">
                            <button id="loadTripButton" class="btn btn-primary">
                                <i class="fas fa-search"></i> Load Existing Trip
                            </button>
                            <span class="or-divider">OR</span>
                            <button id="manualEntryButton" class="btn btn-secondary">
                                <i class="fas fa-pencil-alt"></i> Enter Details Manually
                            </button>
                        </div>
                        <div id="loader" class="loader" style="display: none;"></div>
                    </div>

                    <div class="step-content" data-step-content="2">
                        <h2>Step 2: Verify & Edit Details</h2>

                        <div id="tripSummary" class="trip-summary-box" style="display: none;">
                        </div>

                        <div id="manualEntryFields" style="display: none;">
                            <h4 class="section-divider">Manual Trip Details</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="manualGuestName">Guest Name</label>
                                    <input type="text" id="manualGuestName" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="manualGuestMobile">Guest Mobile</label>
                                    <input type="text" id="manualGuestMobile" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="manualVehicleType">Vehicle Type</label>
                                    <input type="text" id="manualVehicleType" class="form-control"
                                        placeholder="e.g., Etios">
                                </div>
                                <div class="form-group">
                                    <label for="manualVehicleNo">Vehicle No</label>
                                    <input type="text" id="manualVehicleNo" class="form-control"
                                        placeholder="e.g., TN01AB1234">
                                </div>
                                <div class="form-group">
                                    <label for="manualStartDate">Trip Start Date (dd/mm/yyyy)</label>
                                    <input type="text" id="manualStartDate" class="form-control"
                                        placeholder="e.g., 19/10/2025">
                                </div>
                                <div class="form-group">
                                    <label for="manualEndDate">Trip End Date (dd/mm/yyyy)</label>
                                    <input type="text" id="manualEndDate" class="form-control"
                                        placeholder="e.g., 19/10/2025">
                                </div>
                            </div>
                        </div>

                        <h4 class="section-divider">Calculation Details</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="calcTotalHours">
                                    Total Hours (Editable)
                                    <span class="calc-context">
                                        (<span id="time-out-context">--</span> - <span id="time-in-context">--</span> =
                                        <span id="total-hrs-context">--</span>)
                                    </span>
                                </label>
                                <input type="number" id="calcTotalHours" step="0.01" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="calcTotalKms">Total KMs (Editable)</label>
                                <input type="number" id="calcTotalKms" step="0.1" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="calcBillingSlabs">Billing Slabs (Editable)</label>
                                <input type="number" id="calcBillingSlabs" step="1" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="upiId">UPI ID (for QR Code)</label>
                                <input type="text" id="upiId" value="drumsjega5466-1@okhdfcbank" class="form-control">
                            </div>
                        </div>

                        <div class="help-text">
                            <i class="fas fa-info-circle"></i>
                            <strong>What is a "Slab"?</strong> A "Slab" is one 12-hour billing period. If a trip is 20
                            hours long, it falls into 2 slabs (1-12 hrs is 1 slab, 12-24 hrs is 2 slabs).
                        </div>
                    </div>

                    <div class="step-content" data-step-content="3">
                        <h2>Step 3: Enter Billing Rates & Expenses</h2>
                        <p>These values are pre-filled, but you can adjust them as needed.</p>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="baseRate">Base Rate per Slab (₹)</label>
                                <input type="number" id="baseRate" value="1800" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="includedKms">Included KMs per Slab</label>
                                <input type="number" id="includedKms" value="250" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="extraKmRate">Extra KM Rate (₹)</label>
                                <input type="number" id="extraKmRate" value="14" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="battaRate">Driver Batta per Slab (₹)</label>
                                <input type="number" id="battaRate" value="600" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="tolls">Tolls & Parking (₹)</label>
                                <input type="number" id="tolls" placeholder="e.g., 700" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="permits">State Permits (₹)</label>
                                <input type="number" id="permits" value="0" class="form-control">
                            </div>
                        </div>
                    </div>

                    <div class="step-content" data-step-content="4">
                        <h2>Step 4: Review & Generate</h2>
                        <p>Please review the final invoice summary below before saving and generating the link.</p>

                        <div id="finalInvoiceSummary" class="invoice-summary-preview">
                            <div class="loader"></div>
                        </div>

                        <div id="generatedLinkContainer" class="form-group" style="display: none;">
                            <label>Shareable Invoice Link:</label>
                            <input type="text" id="generatedLink" readonly>
                            <button id="copyLinkButton" class="btn">Copy</button>
                        </div>
                        <div id="save-loader" class="loader" style="display: none;"></div>
                    </div>

                </div>

                <div class="step-navigation">
                    <button id="prevStepBtn" class="btn" style="display: none;">
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button id="nextStepBtn" class="btn btn-primary" style="display: none;">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                    <button id="saveInvoiceBtn" class="btn btn-success" style="display: none;">
                        <i class="fas fa-save"></i> Save & Generate
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script src="/assets/js/common.js"></script>
    <script src="/assets/js/generate-invoice.js"></script>
</body>

</html>